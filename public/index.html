<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" href="https://i.ibb.co/5gTmkqfJ/www-codeskytz-site.png" type="image/png">
    <title>CODESKYTZ-MD — Session Generator</title>
    <style>
      :root {
        --bg-dark: #0a0e17;
        --bg-card: rgba(19, 26, 42, 0.7);
        --accent-primary: #00CEC8;
        --accent-secondary: #9c27b0;
        --accent-tertiary: #ff9800;
        --text-primary: #ffffff;
        --text-secondary: #b0b7c3;
        --border: rgba(255,255,255,0.1);
        --success: #4caf50;
        --warning: #ff9800;
        --error: #f44336;
      }
      
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      body {
        margin: 0;
        font-family: 'Segoe UI', system-ui, Arial, sans-serif;
        background: var(--bg-dark);
        color: var(--text-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
        overflow: hidden;
        position: relative;
      }
      
      /* Animated gradient background */
      .gradient-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
      }
      
      .gradient-blob {
        position: absolute;
        border-radius: 50%;
        filter: blur(60px);
        opacity: 0.6;
        animation: float 20s infinite linear;
      }
      
      .blob-1 {
        width: 500px;
        height: 500px;
        background: radial-gradient(circle, var(--accent-primary), transparent);
        top: -200px;
        left: -200px;
        animation-delay: 0s;
      }
      
      .blob-2 {
        width: 600px;
        height: 600px;
        background: radial-gradient(circle, var(--accent-secondary), transparent);
        bottom: -300px;
        right: -200px;
        animation-delay: -5s;
        animation-duration: 25s;
      }
      
      .blob-3 {
        width: 400px;
        height: 400px;
        background: radial-gradient(circle, var(--accent-tertiary), transparent);
        top: 50%;
        left: 70%;
        animation-delay: -10s;
        animation-duration: 30s;
      }
      
      .blob-4 {
        width: 450px;
        height: 450px;
        background: radial-gradient(circle, #00CEC8, #9c27b0);
        bottom: 20%;
        left: 10%;
        animation-delay: -15s;
        animation-duration: 22s;
      }
      
      @keyframes float {
        0% {
          transform: translate(0, 0) rotate(0deg);
        }
        25% {
          transform: translate(50px, 50px) rotate(90deg);
        }
        50% {
          transform: translate(100px, 0) rotate(180deg);
        }
        75% {
          transform: translate(50px, -50px) rotate(270deg);
        }
        100% {
          transform: translate(0, 0) rotate(360deg);
        }
      }
      
      .card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        padding: 32px;
        border-radius: 16px;
        max-width: 500px;
        width: 100%;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
      }
      
      .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary), var(--accent-tertiary));
        animation: gradientShift 3s ease infinite;
        background-size: 200% 200%;
      }
      
      @keyframes gradientShift {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      
      .header {
        display: flex;
        align-items: center;
        margin-bottom: 24px;
      }
      
      .logo {
        width: 48px;
        height: 48px;
        margin-right: 16px;
        border-radius: 8px;
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0, 206, 200, 0.3);
        animation: logoGlow 2s ease-in-out infinite alternate;
      }
      
      @keyframes logoGlow {
        from {
          box-shadow: 0 4px 12px rgba(0, 206, 200, 0.3);
        }
        to {
          box-shadow: 0 4px 20px rgba(0, 206, 200, 0.6), 0 0 30px rgba(156, 39, 176, 0.4);
        }
      }
      
      .logo img {
        width: 32px;
        height: 32px;
        border-radius: 6px;
      }
      
      .title {
        font-size: 24px;
        font-weight: 700;
        background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      
      .subtitle {
        color: var(--text-secondary);
        font-size: 14px;
        margin-top: 4px;
      }
      
      .button-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-bottom: 24px;
      }
      
      button {
        padding: 14px 16px;
        border-radius: 10px;
        border: none;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        position: relative;
        overflow: hidden;
      }
      
      button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
      }
      
      button:hover::before {
        left: 100%;
      }
      
      button.primary {
        background: linear-gradient(135deg, var(--accent-primary), #008f8a);
        color: white;
        box-shadow: 0 4px 15px rgba(0, 206, 200, 0.4);
      }
      
      button.primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 206, 200, 0.6);
      }
      
      button.secondary {
        background: rgba(255, 255, 255, 0.05);
        color: var(--text-primary);
        border: 1px solid var(--border);
      }
      
      button.secondary:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 255, 255, 0.1);
      }
      
      .form-container {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        border: 1px solid var(--border);
        display: none;
        backdrop-filter: blur(10px);
      }
      
      .form-container.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }
      
      label {
        display: block;
        margin-bottom: 8px;
        color: var(--text-secondary);
        font-size: 14px;
        font-weight: 500;
      }
      
      input {
        width: 100%;
        padding: 14px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.05);
        color: var(--text-primary);
        font-size: 14px;
        margin-bottom: 16px;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
      }
      
      input:focus {
        outline: none;
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 2px rgba(0, 206, 200, 0.2);
      }
      
      .qr-container {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 20px;
        border: 1px solid var(--border);
        display: none;
        text-align: center;
        backdrop-filter: blur(10px);
      }
      
      .qr-container.active {
        display: block;
        animation: fadeIn 0.5s ease;
      }
      
      .qr-image {
        max-width: 100%;
        border-radius: 8px;
        margin: 0 auto;
        display: block;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }
      
      .status-container {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 20px;
        border: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 12px;
        backdrop-filter: blur(10px);
      }
      
      .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--warning);
        animation: pulse 2s infinite;
      }
      
      .status-indicator.connected {
        background: var(--success);
      }
      
      .status-text {
        font-size: 14px;
        color: var(--text-secondary);
      }
      
      .footer {
        text-align: center;
        font-size: 13px;
        color: var(--text-secondary);
        padding-top: 16px;
        border-top: 1px solid var(--border);
        text-decoration: none;
      }
      
      .footer strong {
        color: var(--accent-primary);
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }
      
      @media (max-width: 600px) {
        .card {
          padding: 24px 20px;
        }
        
        .button-group {
          grid-template-columns: 1fr;
        }
        
        .title {
          font-size: 20px;
        }
        
        .gradient-blob {
          filter: blur(40px);
        }
        
        .blob-1, .blob-2, .blob-3, .blob-4 {
          width: 300px;
          height: 300px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Animated background elements -->
    <div class="gradient-bg">
      <div class="gradient-blob blob-1"></div>
      <div class="gradient-blob blob-2"></div>
      <div class="gradient-blob blob-3"></div>
      <div class="gradient-blob blob-4"></div>
    </div>
    
    <!-- Main card content -->
    <div class="card">
      <div class="header">
        <div class="logo">
          <img src="https://i.ibb.co/5gTmkqfJ/www-codeskytz-site.png" alt="Bot Icon">
        </div>
        <div>
          <div class="title">CODESKYTZ-MD</div>
          <div class="subtitle">Session Generator</div>
        </div>
      </div>

      <div class="button-group">
        <button id="start-qr" class="primary">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 11H11V3H3V11ZM5 5H9V9H5V5Z" fill="currentColor"/>
            <path d="M3 21H11V13H3V21ZM5 15H9V19H5V15Z" fill="currentColor"/>
            <path d="M13 3V11H21V3H13ZM19 9H15V5H19V9Z" fill="currentColor"/>
            <path d="M21 19H19V21H21V19Z" fill="currentColor"/>
            <path d="M15 13H13V15H15V13Z" fill="currentColor"/>
            <path d="M17 15H15V17H17V15Z" fill="currentColor"/>
            <path d="M15 17H13V19H15V17Z" fill="currentColor"/>
            <path d="M19 17H17V19H19V17Z" fill="currentColor"/>
            <path d="M21 15H19V17H21V15Z" fill="currentColor"/>
            <path d="M13 17V19H15V21H13V19H11V17H13Z" fill="currentColor"/>
            <path d="M17 21H19V19H21V21H17Z" fill="currentColor"/>
          </svg>
          Start QR Session
        </button>
        <button id="start-pair" class="secondary">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M17 7L15.59 8.41L18.17 11H8V13H18.17L15.59 15.58L17 17L22 12L17 7ZM4 5H12V3H4C2.9 3 2 3.9 2 5V19C2 20.1 2.9 21 4 21H12V19H4V5Z" fill="currentColor"/>
          </svg>
          Start Pairing Session
        </button>
      </div>

      <div id="pair-form" class="form-container">
        <label for="phone">Phone number (E.164 without +):</label>
        <input id="phone" type="text" placeholder="2557XXXXXXXX" />
        <button id="pair-submit" class="primary" style="width: 100%;">
          Request Pairing Code
        </button>
      </div>

      <div id="qrbox" class="qr-container"></div>
      
      <div class="status-container">
        <div class="status-indicator" id="status-indicator"></div>
        <div class="status-text" id="status">Status: Idle</div>
      </div>

      <div class="footer">
        Powered by <strong><a href="https://codeskytz.site">CODESKYTZ</a></strong>
      </div>
    </div>

    <script>
      const startQr = document.getElementById('start-qr')
      const startPair = document.getElementById('start-pair')
      const qrbox = document.getElementById('qrbox')
      const status = document.getElementById('status')
      const statusIndicator = document.getElementById('status-indicator')
      const pairForm = document.getElementById('pair-form')
      const pairSubmit = document.getElementById('pair-submit')
      const phoneInput = document.getElementById('phone')

      function setStatus(s) { 
        status.textContent = 'Status: ' + s 
        
        // Update status indicator color based on status
        if (s.includes('Idle')) {
          statusIndicator.style.background = 'var(--warning)'
        } else if (s.includes('Starting') || s.includes('Requesting')) {
          statusIndicator.style.background = 'var(--warning)'
        } else if (s.includes('Received') || s.includes('Sent')) {
          statusIndicator.style.background = 'var(--accent-primary)'
        } else if (s.includes('Finished') || s.includes('Connected')) {
          statusIndicator.style.background = 'var(--success)'
        } else if (s.includes('Error') || s.includes('Failed')) {
          statusIndicator.style.background = 'var(--error)'
        }
      }

      startQr.addEventListener('click', async () => {
        setStatus('Starting QR Flow...')
        qrbox.classList.add('active')
        qrbox.innerHTML = '<p>Waiting for QR code...</p>'

        try {
          const resp = await fetch('/qr', { method: 'POST' })
          const data = await resp.json()
          if (data.qr) {
            qrbox.innerHTML = `<img src="${data.qr}" class="qr-image" alt="QR Code"/>` 
            setStatus('QR Received — Scan with WhatsApp')
            const evt = new EventSource('/events/' + data.sessionId)
            evt.addEventListener('status', (e) => { 
              const d = JSON.parse(e.data); 
              setStatus(d.status) 
            })
            evt.addEventListener('qr', (e) => { 
              const d = JSON.parse(e.data); 
              qrbox.innerHTML = `<img src="${d.qr}" class="qr-image" alt="QR Code"/>` 
            })
            evt.addEventListener('finished', (e) => { 
              setStatus('Finished'); 
              evt.close() 
            })
          } else {
            qrbox.innerHTML = '<p>Failed to get QR code</p>'
            setStatus('Error')
          }
        } catch (error) {
          qrbox.innerHTML = '<p>Error connecting to server</p>'
          setStatus('Connection Error')
        }
      })

      startPair.addEventListener('click', () => { 
        pairForm.classList.toggle('active')
      })

      pairSubmit.addEventListener('click', async () => {
        const phone = phoneInput.value.trim()
        if (!phone) return alert('Please enter phone number in E.164 format without +')
        
        setStatus('Requesting pairing code...')
        
        try {
          const resp = await fetch('/pair', { 
            method: 'POST', 
            headers: {'Content-Type':'application/json'}, 
            body: JSON.stringify({ phoneNumber: phone }) 
          })
          const data = await resp.json()
          if (data.pairingCode) {
            qrbox.classList.add('active')
            qrbox.innerHTML = `
              <div style="background: rgba(0,0,0,0.2); padding: 16px; border-radius: 8px; margin-bottom: 12px;">
                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">Pairing Code</div>
                <div style="font-size: 24px; font-weight: bold; letter-spacing: 4px; color: var(--accent-primary);">${data.pairingCode}</div>
              </div>
              <p style="font-size: 14px; color: var(--text-secondary);">Enter this code in your WhatsApp</p>
            `
            setStatus('Pairing Code Sent — Wait for device to accept')
            const evt = new EventSource('/events/' + data.sessionId)
            evt.addEventListener('status', (e) => { 
              const d = JSON.parse(e.data); 
              setStatus(d.status) 
            })
            evt.addEventListener('pair', (e) => { 
              const d = JSON.parse(e.data); 
              qrbox.innerHTML = `<pre>${d.pairingCode}</pre>` 
            })
            evt.addEventListener('finished', (e) => { 
              setStatus('Finished'); 
              evt.close() 
            })
          } else {
            setStatus('Failed to request pairing code')
          }
        } catch (error) {
          setStatus('Connection Error')
        }
      })
      
      // Initialize status indicator
      setStatus('Idle')
    </script>
  </body>
</html>